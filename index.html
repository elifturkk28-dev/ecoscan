<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoScan: Karbon Dedektifi</title>
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: #f0fdf4; color: #166534; text-align: center; }
        .header { background: #22c55e; color: white; padding: 20px; font-size: 24px; font-weight: bold; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        #scanner-container { width: 100%; max-width: 500px; margin: 20px auto; border: 4px solid #22c55e; border-radius: 20px; overflow: hidden; position: relative; height: 300px; background: black; }
        video { width: 100%; height: 100%; object-fit: cover; }
        .result-card { margin: 20px; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: none; }
        .carbon-grade { font-size: 48px; font-weight: bold; margin: 10px 0; }
        .grade-A { color: #15803d; } .grade-E { color: #b91c1c; }
        .ad-space { background: #e2e8f0; margin: 20px auto; padding: 10px; width: 320px; height: 50px; border: 1px dashed #94a3b8; font-size: 12px; }
        button { background: #22c55e; color: white; border: none; padding: 15px 30px; border-radius: 50px; font-size: 18px; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        button:hover { background: #16a34a; }
    </style>
</head>
<body>

<div class="header">üîç EcoScan</div>

<div id="scanner-container">
    <video id="video"></video>
</div>

<button id="startButton">Tarama Ba≈ülat</button>

<div id="result" class="result-card">
    <h2 id="productName">√úr√ºn Y√ºkleniyor...</h2>
    <div id="carbonGrade" class="carbon-grade">-</div>
    <p id="carbonInfo">Bu √ºr√ºn√ºn √ßevre √ºzerindeki etkisini analiz ediyoruz.</p>
</div>

<div class="ad-space">REKLAM ALANI</div>

<script>
    const codeReader = new ZXing.BrowserMultiFormatReader();
    const videoElement = document.getElementById('video');
    const resultCard = document.getElementById('result');

    document.getElementById('startButton').addEventListener('click', () => {
        codeReader.decodeFromVideoDevice(null, 'video', (result, err) => {
            if (result) {
                console.log(result.text);
                fetchProductData(result.text);
                codeReader.reset(); // Tarama ba≈üarƒ±lƒ±ysa durdur
            }
        });
    });

    function fetchProductData(barcode) {
        resultCard.style.display = 'block';
        document.getElementById('productName').innerText = "Aranƒ±yor...";
        
        // Open Food Facts API Baƒülantƒ±sƒ±
        fetch(`https://world.openfoodfacts.org/api/v0/product/${barcode}.json`)
            .then(response => response.json())
            .then(data => {
                if (data.status === 1) {
                    const product = data.product;
                    document.getElementById('productName').innerText = product.product_name || "Bilinmeyen √úr√ºn";
                    const grade = product.ecoscore_grade ? product.ecoscore_grade.toUpperCase() : "Bilgi Yok";
                    document.getElementById('carbonGrade').innerText = grade;
                    document.getElementById('carbonGrade').className = `carbon-grade grade-${grade}`;
                    document.getElementById('carbonInfo').innerText = `Eko-Skor: ${grade} (A: En D√º≈ü√ºk ƒ∞z, E: En Y√ºksek ƒ∞z)`;
                } else {
                    document.getElementById('productName').innerText = "√úr√ºn Bulunamadƒ±";
                    document.getElementById('carbonGrade').innerText = "?";
                }
            });
    }
</script>

</body>
</html>
