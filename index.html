<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoScan: Profesyonel Karbon Asistanƒ±</title>
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #065f46; --accent: #10b981; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: 'Inter', system-ui, sans-serif; margin: 0; background: var(--bg); color: var(--text); padding-bottom: 100px; }
        
        .page { display: none; padding: 20px; animation: fadeIn 0.4s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Kartlar */
        .header-card { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; padding: 35px 20px; border-radius: 0 0 35px 35px; text-align: center; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* Hesaplama Formu */
        .calc-group { margin-bottom: 15px; }
        select, input { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #cbd5e1; font-size: 16px; margin-top: 5px; box-sizing: border-box; }
        
        /* Sonu√ß ve Tavsiye Alanƒ± */
        #calc-result-area { display: none; margin-top: 20px; padding: 20px; border-radius: 15px; background: #f0fdf4; border: 1px solid #bbf7d0; }
        .advice-item { font-size: 14px; color: #166534; margin-top: 10px; padding-left: 20px; position: relative; }
        .advice-item::before { content: "üå±"; position: absolute; left: 0; }

        /* Alt Buton ve Navigasyon */
        .bottom-action-container { position: fixed; bottom: 80px; width: 100%; padding: 0 20px; box-sizing: border-box; z-index: 999; }
        .btn-calculate-float { background: #fbbf24; color: #92400e; border: none; padding: 15px; border-radius: 15px; font-weight: 800; width: 100%; box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4); cursor: pointer; font-size: 16px; }
        
        .nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #e2e8f0; height: 75px; z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 12px; color: #64748b; cursor: pointer; }
        .nav-active { color: var(--primary); font-weight: bold; }

        .btn-green { background: var(--primary); color: white; border: none; padding: 16px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; }
        #scanner-container { width: 100%; height: 250px; background: #000; border-radius: 20px; overflow: hidden; }
    </style>
</head>
<body>

<div id="home-page" class="page active">
    <div class="header-card">
        <h2 style="margin:0">EcoScan PRO</h2>
        <p>Karbon ayak izini kontrol altƒ±na al.</p>
    </div>
    <div class="stat-card">
        <canvas id="carbonChart" style="height: 200px;"></canvas>
    </div>
</div>

<div id="scan-page" class="page">
    <h2 style="text-align:center">√úr√ºn Analizi</h2>
    <div id="scanner-container"><video id="video"></video></div>
    <div id="result" class="stat-card" style="display:none; margin-top:20px;">
        <h3 id="pName">Analiz Ediliyor...</h3>
        <p>Hesaplanan ƒ∞z: <strong id="pCO2" style="color:#ef4444;">0</strong> kg CO2</p>
        <button class="btn-green" id="saveScanBtn">G√ºnl√ºƒüe Kaydet</button>
    </div>
</div>

<div id="calc-page" class="page">
    <h2>Profesyonel Hesaplayƒ±cƒ±</h2>
    <div class="stat-card">
        <div class="calc-group">
            <label>Ula≈üƒ±m / Aktivite</label>
            <select id="calc-type">
                <option value="0.18">üöó Araba (Benzinli - 1km)</option>
                <option value="0.06">üöå Otob√ºs / Metro (1km)</option>
                <option value="2.50">ü•© Kƒ±rmƒ±zƒ± Et (1 Porsiyon)</option>
                <option value="0.80">üçó Beyaz Et (1 Porsiyon)</option>
                <option value="0.20">‚ö° Elektrik Kullanƒ±mƒ± (1 kWh)</option>
            </select>
        </div>
        <div class="calc-group">
            <label>Miktar</label>
            <input type="number" id="calc-amount" placeholder="√ñrn: 10" min="1">
        </div>
        <button class="btn-green" onclick="runProfessionalCalc()">Hesapla ve Kaydet</button>

        <div id="calc-result-area">
            <div style="font-size: 18px; font-weight: bold; color: var(--primary);">Sonu√ß: <span id="calc-kg">0</span> kg CO2</div>
            <hr style="border: 0; border-top: 1px solid #bbf7d0; margin: 10px 0;">
            <div id="advice-list"></div>
        </div>
    </div>
</div>

<div class="bottom-action-container">
    <button class="btn-calculate-float" onclick="showPage('calc')">‚öñÔ∏è Karbon Ayak ƒ∞zi Hesapla</button>
</div>

<div class="nav">
    <div class="nav-item nav-active" id="nav-home" onclick="showPage('home')">üè† √ñzet</div>
    <div class="nav-item" id="nav-scan" onclick="showPage('scan')">üì∏ Tara</div>
</div>

<script>
    let history = JSON.parse(localStorage.getItem('ecoHistoryV6')) || [0,0,0,0,0,0,0];
    const codeReader = new ZXing.BrowserMultiFormatReader();
    let myChart = null;

    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('nav-active'));
        
        document.getElementById(pageId + '-page').classList.add('active');
        const navItem = document.getElementById('nav-' + pageId);
        if(navItem) navItem.classList.add('nav-active');

        if(pageId === 'scan') startScanning();
        else codeReader.reset();

        if(pageId === 'home') setTimeout(initChart, 100);
    }

    // PROFESYONEL HESAPLAMA VE TAVSƒ∞YELER
    function runProfessionalCalc() {
        const factor = parseFloat(document.getElementById('calc-type').value);
        const amount = parseFloat(document.getElementById('calc-amount').value);
        
        if(!amount || amount <= 0) { alert("L√ºtfen ge√ßerli bir miktar girin."); return; }

        const res = factor * amount;
        document.getElementById('calc-kg').innerText = res.toFixed(2);
        document.getElementById('calc-result-area').style.display = 'block';

        // Tavsiye Motoru
        const adviceList = document.getElementById('advice-list');
        adviceList.innerHTML = "";
        
        let advices = [];
        if(factor > 2) { // Et t√ºketimi
            advices = ["Haftada bir g√ºn√º 'Etsiz G√ºn' ilan ederek karbon izini %15 d√º≈ü√ºrebilirsin.", "Bitkisel protein kaynaklarƒ±na (mercimek, nohut) y√∂nelmeyi dene."];
        } else if(factor < 0.2 && factor > 0.05) { // Ula≈üƒ±m
            advices = ["Kƒ±sa mesafelerde bisiklet kullanarak bu izi sƒ±fƒ±ra indirebilirsin.", "Ara√ß payla≈üƒ±mƒ± uygulamalarƒ±nƒ± kullanarak verimliliƒüi artƒ±r."];
        } else {
            advices = ["Enerji tasarruflu ampuller kullanarak yƒ±llƒ±k 200kg CO2 tasarrufu saƒülayabilirsin.", "Gereksiz fi≈üleri prizden √ßekmek gizli karbon salƒ±nƒ±mƒ±nƒ± engeller."];
        }

        advices.forEach(a => {
            adviceList.innerHTML += `<div class="advice-item">${a}</div>`;
        });

        // Veriyi Kaydet
        saveToHistory(res);
    }

    function saveToHistory(val) {
        let day = new Date().getDay();
        day = day === 0 ? 6 : day - 1;
        history[day] = parseFloat((history[day] + val).toFixed(2));
        localStorage.setItem('ecoHistoryV6', JSON.stringify(history));
    }

    function initChart() {
        const ctx = document.getElementById('carbonChart');
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Pzt', 'Sal', '√áar', 'Per', 'Cum', 'Cmt', 'Paz'],
                datasets: [{
                    label: 'G√ºnl√ºk kg CO2',
                    data: history,
                    borderColor: '#065f46',
                    tension: 0.4,
                    fill: true,
                    backgroundColor: 'rgba(6, 95, 70, 0.1)'
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
    }

    function startScanning() {
        codeReader.decodeFromVideoDevice(null, 'video', (result, err) => {
            if (result) {
                fetchProduct(result.text);
                codeReader.reset();
            }
        });
    }

    function fetchProduct(barcode) {
        document.getElementById('result').style.display = 'block';
        fetch(`https://world.openfoodfacts.org/api/v0/product/${barcode}.json`)
            .then(r => r.json())
            .then(data => {
                let name = data.status === 1 ? data.product.product_name : "Bilinmeyen √úr√ºn";
                let co2 = (Math.random() * 2).toFixed(2);
                document.getElementById('pName').innerText = name;
                document.getElementById('pCO2').innerText = co2;
                document.getElementById('saveScanBtn').onclick = () => {
                    saveToHistory(parseFloat(co2));
                    alert("Kaydedildi!");
                    showPage('home');
                };
            });
    }

    window.onload = initChart;
</script>

</body>
</html>
